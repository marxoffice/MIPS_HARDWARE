# MIPS_HARDWARE
MipsVerilog

## **信号控制码译码信号**

| 指令说明 | instruction | op[5:0]/funct[5:0] | regwrite | regdst | alusrc | branch | memWrite | memtoReg | jump |
| -------- | :---------: | :----------------: | :------: | :----: | :----: | :----: | :------: | :------: | ---- |
|          |   R-type    |       000000       |    1     |   1    |   0    |   0    |    0     |    0     | 0    |
|          |     lw      |       100011       |    1     |   0    |   1    |   0    |    0     |    1     | 0    |
|          |     sw      |       101011       |    0     |   x    |   1    |   0    |    1     |    x     | 0    |
|          |     beq     |       000100       |    0     |   x    |   0    |   1    |    0     |    x     | 0    |
|          |    addi     |       001000       |    1     |   0    |   1    |   0    |    0     |    0     | 0    |
|          |      j      |       000010       |    0     |   x    |   x    |   x    |    0     |    x     | 1    |
|          |             |                    |          |        |        |        |          |          |      |
| logic    |     and     |       100100       |    1     |   1    |   0    |   0    |    0     |    0     | 0    |
|          |     or      |       100101       |    1     |   1    |   0    |   0    |    0     |    0     | 0    |
|          |     xor     |       100110       |    1     |   1    |   0    |   0    |    0     |    0     | 0    |
|          |     nor     |       100111       |    1     |   1    |   0    |   0    |    0     |    0     | 0    |
|          |    andi     |       001100       |    1     |   0    |   1    |   0    |    0     |    0     | 0    |
|          |    xori     |       001110       |    1     |   0    |   1    |   0    |    0     |    0     | 0    |
|          |     lui     |       001111       |    1     |   0    |   1    |   0    |    0     |    0     | 0    |
|          |     ori     |       001101       |    1     |   0    |   1    |   0    |    0     |    0     | 0    |
|          |             |                    |          |        |        |        |          |          |      |
|          |     sll     |       000000       |          |        |        |        |          |          |      |
|          |     srl     |       000010       |          |        |        |        |          |          |      |
|          |     sra     |       000011       |          |        |        |        |          |          |      |
|          |    sllv     |       000100       |          |        |        |        |          |          |      |
|          |    srlv     |       000110       |          |        |        |        |          |          |      |
|          |    srav     |       000111       |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |    mfhi     |       010000       |          |        |        |        |          |          |      |
|          |    mflo     |       010010       |          |        |        |        |          |          |      |
|          |    mthi     |       010001       |          |        |        |        |          |          |      |
|          |    mtlo     |       010011       |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |     add     |       100000       |          |        |        |        |          |          |      |
|          |    addu     |       100001       |          |        |        |        |          |          |      |
|          |     sub     |       100010       |          |        |        |        |          |          |      |
|          |    subu     |       100011       |          |        |        |        |          |          |      |
|          |     slt     |       101010       |          |        |        |        |          |          |      |
|          |    sltu     |       101011       |          |        |        |        |          |          |      |
|          |    mult     |       011000       |          |        |        |        |          |          |      |
|          |    multu    |       011001       |          |        |        |        |          |          |      |
|          |     div     |       011010       |          |        |        |        |          |          |      |
|          |    divu     |       011011       |          |        |        |        |          |          |      |
|          |    addi     |       001000       |          |        |        |        |          |          |      |
|          |    addiu    |       001001       |          |        |        |        |          |          |      |
|          |    slti     |       001010       |          |        |        |        |          |          |      |
|          |    sltiu    |       001011       |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |
|          |             |                    |          |        |        |        |          |          |      |



## 工作日志

#### 2020.12.25

|    时间     |  人员  |                           工作内容                           |
| :---------: | :----: | :----------------------------------------------------------: |
| 10:00-12:00 | 屈湘钧 | 复习计组4的简单五级流水线cpu，并大致整理任务目标和初步的上手想法。 |
| 15:00-18:00 | 屈湘钧 | 学习吕学长教学视频1、2关于57条指令添加教程，并大致思考了添加指令的第一步译码做法，计划明天开始正式开始写controller中的译码和alu译码，分类添加指令集。 |
| 8:00-18:00  | 朱海龙 |             分析实验通路，阅读soc，axi，sram资料             |

#### 2020.12.26

|    时间     |  人员  |                           工作内容                           |
| :---------: | :----: | :----------------------------------------------------------: |
| 10:10-12:00 | 屈湘钧 |                    基本写完alu_dec.v文件                     |
| 14:20-18:00 | 屈湘钧 | 完成大部分逻辑运算指令添加工作；变更指令编码后的计组4测试调试通过 |
| 8:50-17:30  | 朱海龙 |       阅读测试文档，初步完成main_dec和controller的编写       |

#### 2020.12.27

|    时间     |  人员  |                  工作内容                   |
| :---------: | :----: | :-----------------------------------------: |
| 14:40-18:00 | 屈湘钧 |     完成逻辑运算指令8条的添加和测试工作     |
| 9:00-18:30  | 朱海龙 | 完成移位指令添加，完成部分hilo_move指令添加 |



## 测试日志

|    时间    |  人员  |           测试           |
| :--------: | :----: | :----------------------: |
| 2020.12.27 | 屈湘钧 | logic8条指令部分测试完成 |
| 2020.12.28 | 朱海龙 | shift6条指令部分测试完成 |
|            |        |                          |



## 添加指令过程截图

#### 逻辑指令测试完成

```assembly
   lui  $1,0x0101
   ori  $1,$1,0x0101
   ori  $2,$1,0x1100        # $2 = $1 | 0x1100 = 0x01011101
   or   $1,$1,$2            # $1 = $1 | $2 = 0x01011101
   andi $3,$1,0x00fe        # $3 = $1 & 0x00fe = 0x00000000
   and  $1,$3,$1            # $1 = $3 & $1 = 0x00000000
   xori $4,$1,0xff00        # $4 = $1 ^ 0xff00 = 0x0000ff00
   xor  $1,$4,$1            # $1 = $4 ^ $1 = 0x0000ff00
   nor  $1,$4,$1            # $1 = $4 ~^ $1 = 0xffff00ff   nor is "not or"
```

![image-20201227172257935](.\imgs\image-20201227172257935.png)

#### 移位指令测试完成

```asm
   lui   $2,0x0404
   ori   $2,$2,0x0404
   ori   $7,$0,0x7
   ori   $5,$0,0x5
   ori   $8,$0,0x8
   sll   $2,$2,8    ## $2 = 0x40404040 sll 8  = 0x04040400
   sllv  $2,$2,$7   ## $2 = 0x04040400 sll 7  = 0x02020000
   srl   $2,$2,8    ## $2 = 0x02020000 srl 8  = 0x00020200
   srlv  $2,$2,$5   ## $2 = 0x00020200 srl 5  = 0x00001010
   nop
   sll   $2,$2,19   ## $2 = 0x00001010 sll 19 = 0x80800000
   sra   $2,$2,16   ## $2 = 0x80800000 sra 16 = 0xffff8080
   srav  $2,$2,$8   ## $2 = 0xffff8080 sra 8  = 0xffffff80 
```

![TestShift](./imgs/功能移位测试20201228094539.png)

#### 数据移动指令测试完毕

```assembly
   lui $1,0x0000          # $1 = 0x00000000
   lui $2,0xffff          # $2 = 0xffff0000
   lui $3,0x0505          # $3 = 0x05050000
   lui $4,0x0000          # $4 = 0x00000000 

   mthi $0                ## hi = 0x00000000
   mthi $2                ## hi = 0xffff0000
   mthi $3                ## hi = 0x05050000
   mfhi $4                ## $4 = 0x05050000

   mtlo $3                ## lo = 0x05050000
   mtlo $2                ## lo = 0xffff0000
   mtlo $1                ## lo = 0x00000000
   mflo $4                ## $4 = 0x00000000        
## 下图中出现的红色信号的原因是前几条指令一直在操作hi，所以lo就一直是未定义状态
```

![TestShift](./imgs/数据移动测试20201228102906.png)